(self["webpackChunkchronicle"]=self["webpackChunkchronicle"]||[]).push([[611],{3695:function(t,e,i){"use strict";i.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"canvas2d",class:{decoration:t.decoration},on:{mousemove:t.handle_mousemove,mousedown:function(e){t.user.pointer.is_down=!0},mouseup:function(e){t.user.pointer.is_down=!1},contextmenu:t.handle_contextmenu}},[e("canvas",{ref:"canvas"}),t.decoration?e("div",{staticClass:"label"},[e("p",[t._v("Canvas 2D")])]):t._e(),t.show_debug?e("div",{staticClass:"debug-layer"},[e("div",[e("p",[t._v("frames")]),e("p",{domProps:{innerHTML:t._s(`${this.stats.frames_rendered}`)}})]),e("div",[e("p",[t._v("items r/s")]),e("p",{domProps:{innerHTML:t._s(`${this.stats.items_rendered}/${this.stats.items_skipped}`)}})]),e("div",[e("p",[t._v("canvas")]),e("p",{domProps:{innerHTML:t._s(`[${this.width}x${this.height}] (${this.resolution}x)`)}})]),e("div",[e("p",[t._v("viewport")]),e("p",{domProps:{innerHTML:t._s(`${this.viewport.width}x${this.viewport.height}`)}})]),e("div",[e("p",[t._v("user")]),e("p",{domProps:{innerHTML:t._s(`${this.viewport.computed.scale.toFixed(2)}% [x+${this.viewport.computed.offset.x.toFixed(2)}, y+${this.viewport.computed.offset.y.toFixed(2)}]`)}})])]):t._e()])},o=[],r=i(6369),n=r.ZP.extend({name:"Canvas2d",data(){return{height:1,width:1,aspect_ratio:1,resolution:1,viewport:{width:1,height:1,padding:16,rect_size:1,computed:{offset:{x:0,y:0},scale:1},min_scale:.125,max_scale:4},user:{pointer:{position:{x:0,y:0},is_down:!1},scale:1,offset:{x:0,y:0}},stats:{frames_rendered:0,items_rendered:0,items_skipped:0},render_loop:null,items_rendered:0,items_skipped:0}},props:{show_debug:{type:Boolean,default:!1},allow_user_scale:{type:Boolean,default:!1},allow_user_translate:{type:Boolean,default:!1},allow_context_menu:{type:Boolean,default:!1},decoration:{type:Boolean,default:!0}},mounted(){this.resolution=window.devicePixelRatio||1,this.canvas=this.$refs.canvas,this.context=this.canvas.getContext("2d"),this.hidden_canvas=document.createElement("canvas"),this.hidden_context=this.hidden_canvas.getContext("2d"),this.resize_canvas(),this.resize_canvas=this.resize_canvas.bind(this),this.handle_scroll=this.handle_scroll.bind(this),window.addEventListener("resize",this.resize_canvas),this.$el.addEventListener("mousewheel",this.handle_scroll,{passive:!1}),window.addEventListener("keydown",this.handle_keypress)},beforeDestroy(){window.removeEventListener("resize",this.resize_canvas),this.$el.removeEventListener("mousewheel",this.handle_scroll),window.removeEventListener("keydown",this.handle_keypress)},methods:{handle_contextmenu(t){this.allow_context_menu||t.preventDefault()},handle_keypress(t){},reset_user_transform(){this.user.scale=1,this.user.offset.x=0,this.user.offset.y=0,this.compute_viewport(),this.$emit("update")},screen_to_viewport({x:t,y:e}){t*=this.resolution,e*=this.resolution;let i=this.viewport.computed.offset.x*this.viewport.computed.scale,s=this.viewport.computed.offset.y*this.viewport.computed.scale;return{x:(t-i)/this.viewport.computed.scale,y:(e-s)/this.viewport.computed.scale}},viewport_to_screen({x:t,y:e}){let i=this.viewport.computed.offset.x*this.viewport.computed.scale,s=this.viewport.computed.offset.y*this.viewport.computed.scale;return{x:t*this.viewport.computed.scale+i,y:e*this.viewport.computed.scale+s}},handle_mousemove(t){this.user.pointer.position.x=t.offsetX*this.resolution,this.user.pointer.position.y=t.offsetY*this.resolution,this.user.pointer.is_down&&this.allow_user_translate&&(this.user.offset.x+=t.movementX*this.resolution/this.viewport.computed.scale,this.user.offset.y+=t.movementY*this.resolution/this.viewport.computed.scale,this.compute_viewport(),this.$emit("update"))},set_canvas_settings({fill_color:t,stroke_color:e,line_width:i,alpha:s}){void 0!==t&&(this.hidden_context.fillStyle=t),void 0!==e&&(this.hidden_context.strokeStyle=e),void 0!==i&&(this.hidden_context.lineWidth=i*this.viewport.computed.scale),void 0!==s&&(this.hidden_context.globalAlpha=s)},reset_canvas_settings(){this.hidden_context.fillStyle="black",this.hidden_context.strokeStyle="black",this.hidden_context.lineWidth=1,this.hidden_context.globalAlpha=1},handle_scroll(t){if(this.allow_user_scale){t.preventDefault();let e=this.user.scale+-.001*t.deltaY;e=Math.min(Math.max(this.viewport.min_scale,e),this.viewport.max_scale),this.user.offset.x-=this.user.pointer.position.x/this.viewport.computed.scale,this.user.offset.y-=this.user.pointer.position.y/this.viewport.computed.scale,this.compute_viewport(),this.user.scale=e,this.compute_viewport(),this.user.offset.x+=this.user.pointer.position.x/this.viewport.computed.scale,this.user.offset.y+=this.user.pointer.position.y/this.viewport.computed.scale,this.compute_viewport(),this.compute_viewport(),this.$emit("update")}},clear(t){this.hidden_context.clearRect(0,0,this.canvas.width,this.canvas.height),this.hidden_context.fillStyle=t,this.hidden_context.fillRect(0,0,this.canvas.width,this.canvas.height)},draw_rect({x:t,y:e,width:i,height:s,fill_color:o,stroke_color:r,line_width:n=0,alpha:h=1,rotation:d=0}){if(void 0===t||void 0===e||void 0===i||void 0===s)throw new Error("x, y, width, height are required");if(this.should_skip_rendering(t,e,i,s))this.items_skipped++;else{let d=this.viewport.computed.offset.x*this.viewport.computed.scale,a=this.viewport.computed.offset.y*this.viewport.computed.scale;t=t*this.viewport.computed.scale+d,e=e*this.viewport.computed.scale+a,i*=this.viewport.computed.scale,s*=this.viewport.computed.scale,this.set_canvas_settings({fill_color:o,stroke_color:r,line_width:n,alpha:h}),o&&this.hidden_context.fillRect(t,e,i,s),r&&this.hidden_context.strokeRect(t,e,i,s),this.items_rendered++,this.reset_canvas_settings()}},draw_text({x:t,y:e,text:i,fill_color:s,stroke_color:o,font_family:r,font_size:n,font_weight:h,text_align:d,max_width:a,alpha:c=1}){if(void 0===t||void 0===e||void 0===i)throw new Error("x, y, text are required");let p=t,l=e,u=this.viewport.computed.offset.x*this.viewport.computed.scale,v=this.viewport.computed.offset.y*this.viewport.computed.scale;if(t=t*this.viewport.computed.scale+u,e=e*this.viewport.computed.scale+v,r||n||h){r=r||"sans-serif",n=n||16/this.viewport.computed.scale,h=h||"normal",this.hidden_context.font=`${h||""} ${n*this.viewport.computed.scale||""}px ${r}`;let t=1,e=this.measure_text({text:i,font_family:r,font_size:n,font_weight:h});if(this.should_skip_rendering_text(p,l,e.width,e.height))return void this.items_skipped++;a&&e.width>a&&(t=a/e.width),this.hidden_context.font=`${h||""} ${n*this.viewport.computed.scale*t||""}px ${r}`}this.set_canvas_settings({fill_color:s,stroke_color:o}),d&&(this.hidden_context.textAlign=d),s&&this.hidden_context.fillText(i,t,e),o&&this.hidden_context.strokeText(i,t,e),this.items_rendered++,this.reset_canvas_settings()},measure_text({text:t,font_family:e,font_size:i,font_weight:s}){e&&(this.hidden_context.font=`${s||""} ${i*this.viewport.computed.scale||""}px ${e}`);let o=this.hidden_context.measureText(t);return{width:o.width/this.viewport.computed.scale,height:o.actualBoundingBoxAscent/this.viewport.computed.scale}},draw_line({points:t,stroke_color:e,line_width:i,alpha:s=1}){if(void 0===t)throw new Error("points are required");if(t.length<2)throw new Error("at least 2 points are required");if(this.should_skip_rendering_line(i))this.items_skipped++;else{this.set_canvas_settings({stroke_color:e,line_width:i,alpha:s}),this.hidden_context.beginPath();let o=this.viewport.computed.offset.x*this.viewport.computed.scale,r=this.viewport.computed.offset.y*this.viewport.computed.scale;this.hidden_context.moveTo(t[0].x*this.viewport.computed.scale+o,t[0].y*this.viewport.computed.scale+r);for(let e=1;e<t.length;e++)this.hidden_context.lineTo(t[e].x*this.viewport.computed.scale+o,t[e].y*this.viewport.computed.scale+r);this.hidden_context.stroke(),this.items_rendered++,this.reset_canvas_settings()}},resize_canvas(t=!0){if(this.canvas){let e=Math.ceil(this.canvas.clientWidth*this.resolution),i=Math.ceil(this.canvas.clientHeight*this.resolution);this.canvas.width=this.hidden_canvas.width=this.width=e,this.canvas.height=this.hidden_canvas.height=this.height=i,this.aspect_ratio=this.width/this.height,this.compute_viewport(),t&&this.$emit("update")}},render(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.hidden_canvas,0,0),this.stats.frames_rendered++,this.stats.items_rendered=this.items_rendered,this.stats.items_skipped=this.items_skipped,this.items_rendered=0,this.items_skipped=0},compute_viewport(){let t=1,e=this.viewport.width/this.viewport.height,i=this.width-2*this.viewport.padding,s=this.height-2*this.viewport.padding;e>this.aspect_ratio?(t=i/this.viewport.width,this.viewport.rect_size=i):(t=s/this.viewport.height,this.viewport.rect_size=s),this.viewport.computed.scale=t*this.user.scale,this.viewport.computed.offset.x=this.user.offset.x,this.viewport.computed.offset.y=this.user.offset.y},centrize(){this.user.offset.x=(this.width/this.viewport.computed.scale-this.viewport.width)/2,this.user.offset.y=(this.height/this.viewport.computed.scale-this.viewport.height)/2,this.compute_viewport(),this.$emit("update")},should_skip_rendering(t,e,i,s){let o=this.viewport.computed.offset.x*this.viewport.computed.scale,r=this.viewport.computed.offset.y*this.viewport.computed.scale;return t=t*this.viewport.computed.scale+o,e=e*this.viewport.computed.scale+r,i*=this.viewport.computed.scale,s*=this.viewport.computed.scale,i<this.resolution/2||s<this.resolution/2||(t>this.width||t+i<0||e>this.height||e+s<0)},should_skip_rendering_line(t){return t*this.viewport.computed.scale<this.resolution/2},should_skip_rendering_text(t,e,i,s){return s*this.viewport.computed.scale<4*this.resolution||this.should_skip_rendering(t,e,i,s)}}}),h=n,d=i(1001),a=(0,d.Z)(h,s,o,!1,null,null,null),c=a.exports},7471:function(t){(function(e,i){t.exports=i()})(0,(function(){"use strict";return t.importState=function(e){var i=new t;return i.importState(e),i},t;function t(){return function(t){var i=0,s=0,o=0,r=1;0==t.length&&(t=[+new Date]);var n=e();i=n(" "),s=n(" "),o=n(" ");for(var h=0;h<t.length;h++)i-=n(t[h]),i<0&&(i+=1),s-=n(t[h]),s<0&&(s+=1),o-=n(t[h]),o<0&&(o+=1);n=null;var d=function(){var t=2091639*i+2.3283064365386963e-10*r;return i=s,s=o,o=t-(r=0|t)};return d.next=d,d.uint32=function(){return 4294967296*d()},d.fract53=function(){return d()+11102230246251565e-32*(2097152*d()|0)},d.version="Alea 0.9",d.args=t,d.exportState=function(){return[i,s,o,r]},d.importState=function(t){i=+t[0]||0,s=+t[1]||0,o=+t[2]||0,r=+t[3]||0},d}(Array.prototype.slice.call(arguments))}function e(){var t=4022871197,e=function(e){e=e.toString();for(var i=0;i<e.length;i++){t+=e.charCodeAt(i);var s=.02519603282416938*t;t=s>>>0,s-=t,s*=t,t=s>>>0,s-=t,t+=4294967296*s}return 2.3283064365386963e-10*(t>>>0)};return e.version="Mash 0.9",e}}))},7327:function(t,e,i){"use strict";function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function o(t,e){if("object"!==s(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!==s(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function r(t){var e=o(t,"string");return"symbol"===s(e)?e:String(e)}function n(t,e,i){return e=r(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,{Z:function(){return n}})}}]);
//# sourceMappingURL=611.js.map